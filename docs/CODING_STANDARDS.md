# üìã SprintFlow - Quy t·∫Øc Code v√† Commit Standards

## üéØ M·ª•c ti√™u

T√†i li·ªáu n√†y ƒë·ªãnh nghƒ©a c√°c quy t·∫Øc v√† ti√™u chu·∫©n cho vi·ªác vi·∫øt code v√† commit trong d·ª± √°n SprintFlow, ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n, d·ªÖ b·∫£o tr√¨ v√† ch·∫•t l∆∞·ª£ng cao.

---

## üìù Quy t·∫Øc Commit Messages

### üèóÔ∏è Conventional Commits Format

```bash
type(scope): description #issue_number

# V√≠ d·ª•:
feat(auth): add JWT authentication system #1
fix(tasks): resolve task assignment bug #2
docs(api): update API documentation #3
```

### üìã Types (B·∫Øt bu·ªôc)

| Type       | M√¥ t·∫£                                        | V√≠ d·ª•                                          |
| ---------- | -------------------------------------------- | ---------------------------------------------- |
| `feat`     | T√≠nh nƒÉng m·ªõi                                | `feat(auth): add login functionality`          |
| `fix`      | S·ª≠a l·ªói                                      | `fix(ui): resolve button alignment issue`      |
| `docs`     | Thay ƒë·ªïi documentation                       | `docs(readme): update installation guide`      |
| `style`    | Thay ƒë·ªïi format code (kh√¥ng ·∫£nh h∆∞·ªüng logic) | `style(components): format code with prettier` |
| `refactor` | Refactor code (kh√¥ng th√™m t√≠nh nƒÉng/s·ª≠a l·ªói) | `refactor(services): restructure user service` |
| `test`     | Th√™m/s·ª≠a test                                | `test(auth): add unit tests for login`         |
| `chore`    | C√¥ng vi·ªác b·∫£o tr√¨                            | `chore(deps): update dependencies`             |
| `perf`     | C·∫£i thi·ªán performance                        | `perf(api): optimize database queries`         |
| `ci`       | Thay ƒë·ªïi CI/CD                               | `ci(pipeline): add GitHub Actions workflow`    |
| `build`    | Thay ƒë·ªïi build system                        | `build(docker): update Docker configuration`   |
| `revert`   | Revert commit tr∆∞·ªõc ƒë√≥                       | `revert: revert "feat: add new feature"`       |

### üéØ Scopes (B·∫Øt bu·ªôc)

| Scope         | M√¥ t·∫£                  | V√≠ d·ª•                                         |
| ------------- | ---------------------- | --------------------------------------------- |
| `auth`        | Authentication module  | `feat(auth): add OAuth integration`           |
| `users`       | User management        | `fix(users): resolve user profile update`     |
| `projects`    | Project management     | `feat(projects): add project templates`       |
| `tasks`       | Task management        | `fix(tasks): resolve task assignment bug`     |
| `milestones`  | Milestone management   | `feat(milestones): add milestone tracking`    |
| `attachments` | File attachments       | `fix(attachments): resolve file upload issue` |
| `ui`          | Frontend UI components | `style(ui): improve button design`            |
| `api`         | Backend API            | `perf(api): optimize response time`           |
| `database`    | Database changes       | `fix(database): resolve migration issue`      |
| `ci`          | CI/CD pipeline         | `ci(pipeline): add automated testing`         |
| `deps`        | Dependencies           | `chore(deps): update React to v18`            |
| `config`      | Configuration files    | `chore(config): update ESLint rules`          |
| `docs`        | Documentation          | `docs(api): add API documentation`            |
| `test`        | Testing                | `test(auth): add integration tests`           |
| `docker`      | Docker configuration   | `build(docker): optimize image size`          |
| `release`     | Release process        | `ci(release): add automated release`          |

### üìè Quy t·∫Øc Description

- **ƒê·ªô d√†i**: T·ªëi ƒëa 72 k√Ω t·ª±
- **Ng√¥n ng·ªØ**: Ti·∫øng Anh
- **Th√¨**: S·ª≠ d·ª•ng imperative mood (nh∆∞ ƒëang ra l·ªánh)
- **Kh√¥ng d·∫•u ch·∫•m** ·ªü cu·ªëi
- **Issue reference**: Lu√¥n th√™m `#issue_number` ·ªü cu·ªëi

```bash
# ‚úÖ Good
feat(auth): add JWT authentication system #1
fix(tasks): resolve task assignment bug #2

# ‚ùå Bad
feat(auth): added JWT authentication system. #1
fix(tasks): resolving task assignment bug #2
feat(auth): add JWT authentication system for user login and logout with refresh token support #1
```

### üîó Issue References

```bash
# Single issue
feat(auth): add JWT authentication #1

# Multiple issues
feat(auth): add JWT authentication #1 #2

# Related issues
feat(auth): add JWT authentication #1
# Relates to #2
```

---

## üíª Quy t·∫Øc Code

### üé® TypeScript/JavaScript

#### 1. **Naming Conventions**

```typescript
// ‚úÖ Variables v√† Functions - camelCase
const userName = 'john';
const getUserData = () => {};

// ‚úÖ Classes v√† Interfaces - PascalCase
class UserService {}
interface UserData {}

// ‚úÖ Constants - UPPER_SNAKE_CASE
const API_BASE_URL = 'https://api.example.com';
const MAX_RETRY_ATTEMPTS = 3;

// ‚úÖ Private methods - underscore prefix
class UserService {
  private _validateUser() {}
  private _formatData() {}
}
```

#### 2. **File Naming**

```bash
# ‚úÖ Components - PascalCase
UserProfile.tsx
ProjectCard.tsx
TaskList.tsx

# ‚úÖ Services/Utils - camelCase
userService.ts
apiClient.ts
dateUtils.ts

# ‚úÖ Constants - camelCase
constants.ts
apiEndpoints.ts

# ‚úÖ Types - camelCase
userTypes.ts
projectTypes.ts
```

#### 3. **Import/Export**

```typescript
// ‚úÖ Named exports
export const UserService = {};
export interface UserData {}

// ‚úÖ Default exports (ch·ªâ cho components)
export default UserProfile;

// ‚úÖ Import order
// 1. React imports
import React, { useState, useEffect } from 'react';

// 2. Third-party libraries
import { Box, Button, Typography } from '@mui/material';
import axios from 'axios';

// 3. Internal modules
import { UserService } from '@/services/userService';
import { UserData } from '@/types/userTypes';

// 4. Relative imports
import './UserProfile.css';
```

### üß© React Components

#### 1. **Component Structure**

```typescript
// ‚úÖ Component template
import React, { useState, useEffect } from 'react';
import { Box, Button, Typography } from '@mui/material';

interface UserProfileProps {
  userId: string;
  onUpdate?: (data: UserData) => void;
}

const UserProfile: React.FC<UserProfileProps> = ({ userId, onUpdate }) => {
  // 1. State declarations
  const [user, setUser] = useState<UserData | null>(null);
  const [loading, setLoading] = useState(false);

  // 2. Effects
  useEffect(() => {
    loadUserData();
  }, [userId]);

  // 3. Event handlers
  const handleUpdate = async (data: UserData) => {
    setLoading(true);
    try {
      await UserService.update(userId, data);
      setUser(data);
      onUpdate?.(data);
    } catch (error) {
      console.error('Failed to update user:', error);
    } finally {
      setLoading(false);
    }
  };

  // 4. Render
  if (loading) return <div>Loading...</div>;
  if (!user) return <div>User not found</div>;

  return (
    <Box>
      <Typography variant="h4">{user.name}</Typography>
      <Button onClick={() => handleUpdate(user)}>
        Update
      </Button>
    </Box>
  );
};

export default UserProfile;
```

#### 2. **Component Rules**

- **T·ªëi ƒëa 200 d√≤ng** cho m·ªói component
- **Single Responsibility**: M·ªói component ch·ªâ l√†m m·ªôt vi·ªác
- **Props Interface**: Lu√¥n ƒë·ªãnh nghƒ©a interface cho props
- **Error Boundaries**: S·ª≠ d·ª•ng error boundaries cho components quan tr·ªçng
- **Loading States**: Lu√¥n c√≥ loading state cho async operations

#### 3. **Hooks Usage**

```typescript
// ‚úÖ Custom hooks
const useUser = (userId: string) => {
  const [user, setUser] = useState<UserData | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    loadUser();
  }, [userId]);

  const loadUser = async () => {
    setLoading(true);
    try {
      const data = await UserService.getById(userId);
      setUser(data);
    } catch (err) {
      setError(err.message);
    } finally {
      setLoading(false);
    }
  };

  return { user, loading, error, refetch: loadUser };
};
```

### üóÑÔ∏è Backend (NestJS)

#### 1. **Service Structure**

```typescript
// ‚úÖ Service template
@Injectable()
export class UserService {
  constructor(
    @InjectModel(User.name) private userModel: Model<User>,
    private readonly logger: Logger,
  ) {}

  async create(createUserDto: CreateUserDto): Promise<User> {
    try {
      const user = new this.userModel(createUserDto);
      return await user.save();
    } catch (error) {
      this.logger.error('Failed to create user', error);
      throw new BadRequestException('Failed to create user');
    }
  }

  async findById(id: string): Promise<User> {
    const user = await this.userModel.findById(id).exec();
    if (!user) {
      throw new NotFoundException('User not found');
    }
    return user;
  }
}
```

#### 2. **Controller Structure**

```typescript
// ‚úÖ Controller template
@Controller('users')
@ApiTags('Users')
export class UsersController {
  constructor(private readonly usersService: UsersService) {}

  @Post()
  @ApiOperation({ summary: 'Create a new user' })
  @ApiResponse({ status: 201, description: 'User created successfully' })
  async create(@Body() createUserDto: CreateUserDto): Promise<User> {
    return this.usersService.create(createUserDto);
  }

  @Get(':id')
  @ApiOperation({ summary: 'Get user by ID' })
  @ApiResponse({ status: 200, description: 'User found' })
  @ApiResponse({ status: 404, description: 'User not found' })
  async findOne(@Param('id') id: string): Promise<User> {
    return this.usersService.findById(id);
  }
}
```

### üé® Styling

#### 1. **CSS/SCSS**

```scss
// ‚úÖ BEM Methodology
.user-profile {
  &__header {
    display: flex;
    align-items: center;
    
    &--large {
      font-size: 24px;
    }
  }
  
  &__content {
    padding: 16px;
  }
  
  &__actions {
    display: flex;
    gap: 8px;
  }
}
```

#### 2. **Material-UI**

```typescript
// ‚úÖ Theme usage
const useStyles = makeStyles((theme: Theme) => ({
  root: {
    padding: theme.spacing(2),
    backgroundColor: theme.palette.background.paper,
  },
  title: {
    color: theme.palette.primary.main,
    marginBottom: theme.spacing(2),
  },
}));
```

---

## üîç Code Quality Rules

### 1. **ESLint Rules**

```javascript
// ‚úÖ Strict rules
'@typescript-eslint/no-unused-vars': ['error', { argsIgnorePattern: '^_' }],
'@typescript-eslint/no-explicit-any': 'warn',
'no-console': 'warn',
'no-debugger': 'error',
'prefer-const': 'error',
'no-var': 'error',

// ‚úÖ Component rules (web only)
'max-lines-per-function': ['error', 200, { 
  skipBlankLines: true, 
  skipComments: true 
}],
```

### 2. **Prettier Configuration**

```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 80,
  "tabWidth": 2,
  "useTabs": false
}
```

### 3. **TypeScript Rules**

```json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true
  }
}
```

---

## üìÅ File Organization

### 1. **Frontend Structure**

```
apps/web/
‚îú‚îÄ‚îÄ app/                    # Next.js app directory
‚îú‚îÄ‚îÄ components/            # Reusable components
‚îÇ   ‚îú‚îÄ‚îÄ ui/               # Basic UI components
‚îÇ   ‚îú‚îÄ‚îÄ forms/            # Form components
‚îÇ   ‚îî‚îÄ‚îÄ layouts/          # Layout components
‚îú‚îÄ‚îÄ hooks/                # Custom hooks
‚îú‚îÄ‚îÄ services/             # API services
‚îú‚îÄ‚îÄ types/                # TypeScript types
‚îú‚îÄ‚îÄ utils/                # Utility functions
‚îî‚îÄ‚îÄ styles/               # Global styles
```

### 2. **Backend Structure**

```
apps/server/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ modules/          # Feature modules
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ projects/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tasks/
‚îÇ   ‚îú‚îÄ‚îÄ shared/           # Shared utilities
‚îÇ   ‚îú‚îÄ‚îÄ decorators/       # Custom decorators
‚îÇ   ‚îî‚îÄ‚îÄ utils/            # Utility functions
‚îî‚îÄ‚îÄ test/                 # Test files
```

---

## üß™ Testing Standards

### 1. **Unit Tests**

```typescript
// ‚úÖ Test template
describe('UserService', () => {
  let service: UserService;
  let mockUserModel: jest.Mocked<Model<User>>;

  beforeEach(async () => {
    const module = await Test.createTestingModule({
      providers: [
        UserService,
        {
          provide: getModelToken(User.name),
          useValue: mockUserModel,
        },
      ],
    }).compile();

    service = module.get<UserService>(UserService);
  });

  describe('create', () => {
    it('should create a new user', async () => {
      const createUserDto = { name: 'John', email: 'john@example.com' };
      const expectedUser = { id: '1', ...createUserDto };

      mockUserModel.save.mockResolvedValue(expectedUser);

      const result = await service.create(createUserDto);

      expect(result).toEqual(expectedUser);
      expect(mockUserModel.save).toHaveBeenCalledWith(createUserDto);
    });
  });
});
```

### 2. **Component Tests**

```typescript
// ‚úÖ Component test template
describe('UserProfile', () => {
  const mockUser = { id: '1', name: 'John', email: 'john@example.com' };

  it('should render user information', () => {
    render(<UserProfile user={mockUser} />);
    
    expect(screen.getByText('John')).toBeInTheDocument();
    expect(screen.getByText('john@example.com')).toBeInTheDocument();
  });

  it('should call onUpdate when update button is clicked', () => {
    const mockOnUpdate = jest.fn();
    render(<UserProfile user={mockUser} onUpdate={mockOnUpdate} />);
    
    fireEvent.click(screen.getByText('Update'));
    
    expect(mockOnUpdate).toHaveBeenCalledWith(mockUser);
  });
});
```

---

## üöÄ Performance Guidelines

### 1. **Frontend Optimization**

```typescript
// ‚úÖ Lazy loading
const LazyComponent = lazy(() => import('./LazyComponent'));

// ‚úÖ Memoization
const ExpensiveComponent = memo(({ data }) => {
  return <div>{expensiveCalculation(data)}</div>;
});

// ‚úÖ Custom hooks for data fetching
const useUserData = (userId: string) => {
  return useSWR(`/api/users/${userId}`, fetcher);
};
```

### 2. **Backend Optimization**

```typescript
// ‚úÖ Database indexing
@Schema({ timestamps: true })
export class User {
  @Prop({ index: true })
  email: string;

  @Prop({ index: true })
  username: string;
}

// ‚úÖ Caching
@Injectable()
export class UserService {
  async findById(id: string): Promise<User> {
    const cacheKey = `user:${id}`;
    let user = await this.cacheManager.get(cacheKey);
    
    if (!user) {
      user = await this.userModel.findById(id).exec();
      await this.cacheManager.set(cacheKey, user, 300); // 5 minutes
    }
    
    return user;
  }
}
```

---

## üîí Security Guidelines

### 1. **Input Validation**

```typescript
// ‚úÖ DTO validation
export class CreateUserDto {
  @IsString()
  @IsNotEmpty()
  @Length(2, 50)
  name: string;

  @IsEmail()
  email: string;

  @IsString()
  @MinLength(8)
  @Matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/)
  password: string;
}
```

### 2. **Authentication & Authorization**

```typescript
// ‚úÖ JWT validation
@UseGuards(JwtAuthGuard)
@Roles(Role.ADMIN)
@Get('admin/users')
async getAdminUsers() {
  return this.usersService.findAll();
}
```

---

## üìö Documentation Standards

### 1. **Code Comments**

```typescript
/**
 * Creates a new user in the system
 * @param createUserDto - User data to create
 * @returns Promise<User> - Created user object
 * @throws BadRequestException - If user data is invalid
 */
async create(createUserDto: CreateUserDto): Promise<User> {
  // Implementation
}
```

### 2. **API Documentation**

```typescript
@ApiOperation({ 
  summary: 'Create a new user',
  description: 'Creates a new user account with the provided information'
})
@ApiResponse({ 
  status: 201, 
  description: 'User created successfully',
  type: User 
})
@ApiResponse({ 
  status: 400, 
  description: 'Invalid user data',
  type: BadRequestResponse 
})
```

---

## üîÑ Git Workflow

### 1. **Branch Naming**

```bash
# ‚úÖ Feature branches
feature/issue-1-add-jwt-authentication
feature/issue-2-implement-kanban-board

# ‚úÖ Bug fix branches
fix/issue-3-resolve-login-bug
fix/issue-4-fix-task-assignment

# ‚úÖ Hotfix branches
hotfix/issue-5-critical-security-fix
```

### 2. **Commit Frequency**

- **Small commits**: M·ªói commit n√™n th·ª±c hi·ªán m·ªôt thay ƒë·ªïi logic
- **Frequent commits**: Commit th∆∞·ªùng xuy√™n ƒë·ªÉ track progress
- **Meaningful messages**: Commit message ph·∫£i m√¥ t·∫£ r√µ thay ƒë·ªïi

### 3. **Pull Request**

```markdown
## üéØ Description
Brief description of changes

## üîó Related Issues
Closes #1
Relates to #2

## ‚úÖ Checklist
- [ ] Code follows style guidelines
- [ ] Self-review completed
- [ ] Tests added/updated
- [ ] Documentation updated

## üìù Changes Made
- Add JWT authentication
- Implement user login/logout
- Add refresh token logic

## üß™ Testing
- [x] Unit tests pass
- [x] Integration tests pass
- [x] Manual testing completed
```

---

## üéØ Best Practices Summary

### ‚úÖ Do's

- ‚úÖ S·ª≠ d·ª•ng TypeScript strict mode
- ‚úÖ Vi·∫øt tests cho m·ªçi logic quan tr·ªçng
- ‚úÖ Follow naming conventions
- ‚úÖ Keep components under 200 lines
- ‚úÖ Use meaningful commit messages
- ‚úÖ Document complex logic
- ‚úÖ Handle errors gracefully
- ‚úÖ Optimize for performance

### ‚ùå Don'ts

- ‚ùå S·ª≠ d·ª•ng `any` type
- ‚ùå Commit code kh√¥ng test
- ‚ùå Vi·∫øt components qu√° d√†i
- ‚ùå Ignore ESLint warnings
- ‚ùå Commit v·ªõi message kh√¥ng r√µ r√†ng
- ‚ùå Hardcode values
- ‚ùå Ignore error handling

---

*Tu√¢n th·ªß c√°c quy t·∫Øc n√†y s·∫Ω gi√∫p d·ª± √°n SprintFlow c√≥ code ch·∫•t l∆∞·ª£ng cao, d·ªÖ b·∫£o tr√¨ v√† m·ªü r·ªông.* 